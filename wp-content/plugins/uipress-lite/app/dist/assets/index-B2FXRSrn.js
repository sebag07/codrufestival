import{e as _,o as g,g as v,t as i,y as a,B as c,a8 as m,f as O,x as f,D as A,q as h,u as E}from"./index-COn-5JHg.js";const{__:l}=wp.i18n,k={props:{args:Object,triggerClass:String},data(){return{modelOpen:!0,themeLoading:!1,themes:[],saving:!1,finished:!1,strings:{globalExport:l("Global export"),settingsExplanation:l("Choose the sections you wish to export to another site and click export to generate a file containing all of uiPress settings, templates, menus and theme styles","uipress-lite"),templates:l("Templates","uipress-lite"),siteSettings:l("Site settings","uipress-lite"),themeStyles:l("Theme styles","uipress-lite"),adminMenus:l("Admin menus","uipress-lite"),cancel:l("Cancel","uipress-lite"),export:l("Export","uipress-lite")},exportOptions:{templates:!0,siteSettings:!0,themeStyles:!0,adminMenus:!0}}},watch:{currentStep:{handler(o,e){o==2&&this.fetchThemes()}}},computed:{isDisabledButton(){if(!this.exportOptions.templates&&!this.exportOptions.siteSettings&&!this.exportOptions.themeStyles&&!this.exportOptions.adminMenus)return!0}},methods:{async exportEverything(){let o=new FormData;o.append("action","uip_global_export"),o.append("security",uip_ajax.security),o.append("options",JSON.stringify(this.exportOptions));const e=this.uipApp.notifications.notify(l("Exporting uiPress content","uipress-lite"),"","default",!1,!0),n=await this.sendServerRequest(uip_ajax.ajax_url,o);if(!n||n.error){this.uipApp.notifications.notify(n.message,"","error",!0);return}this.downloadExport(n.export,e)},async downloadExport(o,e){let n="uip-global-export-",s=this.prepareJSON({uipGlobalExport:o}),t=new Date,p=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),u=t.getFullYear(),y=r+"-"+p+"-"+u,b=n+"-"+y+".json",S="data:text/json;charset=utf-8,"+encodeURIComponent(s),x=this.$refs.globalExport;x.setAttribute("href",S),x.setAttribute("download",b),x.click(),this.uipApp.notifications.notify(l("Export complete","uipress-lite"),"","success"),this.uipApp.notifications.remove(e)}}},w={class:"uip-grid-col-4-6",style:{"grid-gap":"var(--uip-margin-l)"}},D={class:"uip-flex uip-flex-column uip-gap-xxs"},j={class:"uip-text-emphasis"},C={class:"uip-text-muted"},I={class:"uip-flex uip-flex-column uip-row-gap-xs uip-flex-start"},T={class:"uip-flex uip-gap-xs uip-flex-center"},M={class:""},G={class:"uip-flex uip-gap-xs uip-flex-center"},N={class:""},V={class:"uip-flex uip-gap-xs uip-flex-center"},B={class:""},J={class:"uip-flex uip-gap-xs uip-flex-center"},R={class:""},U=["disabled"],F={class:"uip-hidden",ref:"globalExport"};function L(o,e,n,s,t,p){return g(),v("div",w,[i("div",D,[i("span",j,a(t.strings.globalExport),1),i("div",C,a(t.strings.settingsExplanation),1)]),i("div",I,[i("label",T,[c(i("input",{class:"uip-user-check uip-checkbox uip-margin-remove","onUpdate:modelValue":e[0]||(e[0]=r=>t.exportOptions.templates=r),type:"checkbox"},null,512),[[m,t.exportOptions.templates]]),i("div",M,a(t.strings.templates),1)]),i("label",G,[c(i("input",{class:"uip-user-check uip-checkbox uip-margin-remove","onUpdate:modelValue":e[1]||(e[1]=r=>t.exportOptions.siteSettings=r),type:"checkbox"},null,512),[[m,t.exportOptions.siteSettings]]),i("div",N,a(t.strings.siteSettings),1)]),i("label",V,[c(i("input",{class:"uip-user-check uip-checkbox uip-margin-remove","onUpdate:modelValue":e[2]||(e[2]=r=>t.exportOptions.themeStyles=r),type:"checkbox"},null,512),[[m,t.exportOptions.themeStyles]]),i("div",B,a(t.strings.themeStyles),1)]),i("label",J,[c(i("input",{class:"uip-user-check uip-checkbox uip-margin-remove","onUpdate:modelValue":e[3]||(e[3]=r=>t.exportOptions.adminMenus=r),type:"checkbox"},null,512),[[m,t.exportOptions.adminMenus]]),i("div",R,a(t.strings.adminMenus),1)]),i("button",{onClick:e[4]||(e[4]=r=>p.exportEverything()),class:"uip-button-primary uip-w-200 uip-margin-top-s",disabled:p.isDisabledButton},a(t.strings.export),9,U),i("a",F,null,512)])])}const P=_(k,[["render",L]]),{__:d}=wp.i18n,q={props:{args:Object,triggerClass:String},data(){return{modelOpen:!0,themeLoading:!1,themes:[],saving:!1,finished:!1,validDrop:!1,strings:{globalImport:d("Global import"),settingsExplanation:d("If you have global exported uiPress on another site then drag and select the .json file below to import.","uipress-lite")}}},watch:{currentStep:{handler(o,e){o==2&&this.fetchThemes()}}},computed:{isDisabledButton(){if(!this.exportOptions.templates&&!this.exportOptions.siteSettings&&!this.exportOptions.themeStyles&&!this.exportOptions.adminMenus)return!0}},methods:{importEverything(o,e){this.validDrop=!1;const n=this.uipApp.notifications.notify(d("Importing uiPress content","uipress-lite"),"","default",!1,!0);let s;if(e?s=o.dataTransfer.files[0]:s=event.target.files[0],s.type!="application/json"){this.uipApp.notifications.notify(d("Global exports must be in valid JSON format","uipress-lite"),"","error",!0,!1),this.uipApp.notifications.remove(n);return}let t=new FileReader;t.readAsText(s,"UTF-8"),t.onload=p=>this.handleReaderLoad(p,n)},handleReaderLoad(o,e){let n=o.target.result,s;try{s=JSON.parse(n)}catch(p){this.uipApp.notifications.notify(p,"","error",!0,!1),this.uipApp.notifications.remove(e);return}if(!s){this.uipApp.notifications.notify(d("JSON parse failed","uipress-lite"),"","error",!0,!1),this.uipApp.notifications.remove(e);return}if(!Array.isArray(s)&&!this.isObject(s)){this.uipApp.notifications.notify("Export is not valid","","error",!0,!1),this.uipApp.notifications.remove(e);return}let t=!1;if("uipGlobalExport"in s)t=s.uipGlobalExport;else{this.uipApp.notifications.notify(d("Template mismatch","uipress-lite"),"","error",!0,!1),this.uipApp.notifications.remove(e);return}this.sendImportToServer(t,e)},async sendImportToServer(o,e){let n=new FormData;n.append("action","uip_global_import"),n.append("security",uip_ajax.security),n.append("content",JSON.stringify(o));const s=await this.sendServerRequest(uip_ajax.ajax_url,n);if(s.error){this.uipApp.notifications.notify(s.message,"","error",!0);return}this.uipApp.notifications.notify(d("Content imported succesfully","uipress-lite"),"","success"),this.uipApp.notifications.remove(e),this.$router.push("/"),setTimeout(function(){location.reload()},600)}}},z={class:"uip-grid-col-4-6",style:{"grid-gap":"var(--uip-margin-l)"}},Y={class:"uip-flex uip-flex-column uip-gap-xxs"},H={class:"uip-text-emphasis"},K={class:"uip-text-muted"},Q={class:"uip-flex uip-flex-column uip-row-gap-xs"};function W(o,e,n,s,t,p){const r=O("AppIcon");return g(),v("div",z,[i("div",Y,[i("span",H,a(t.strings.globalImport),1),i("div",K,a(t.strings.settingsExplanation),1)]),i("div",Q,[i("label",{onDrop:e[1]||(e[1]=f(u=>p.importEverything(u,!0),["prevent"])),onDragenter:e[2]||(e[2]=f(u=>t.validDrop=!0,["prevent"])),onDragleave:e[3]||(e[3]=f(u=>t.validDrop=!1,["prevent"])),onDragover:e[4]||(e[4]=f(u=>t.validDrop=!0,["prevent"])),class:A([{"uip-background-primary-wash":t.validDrop,"uip-background-muted":!t.validDrop},"uip-background-muted uip-border uip-border-rounder uip-padding-m uip-flex uip-flex-middle uip-flex-center uip-transition-all uip-link-muted"])},[h(r,{icon:"file_upload",class:"uip-icon uip-text-xl"}),i("input",{hidden:"",accept:".json",type:"file",single:"",id:"uip-import-layout",onChange:e[0]||(e[0]=u=>p.importEverything(u))},null,32)],34)])])}const X=_(q,[["render",W]]),Z={class:"uip-flex uip-flex-column uip-gap-m uip-padding-top-s"},$={class:"uip-text-l uip-text-emphasis"},te={__name:"index",setup(o){const{__:e}=wp.i18n;return(n,s)=>(g(),v("div",Z,[i("div",$,a(E(e)("Import and export uipress settings","uipress-lite")),1),s[0]||(s[0]=i("div",{class:"uip-border-bottom"},null,-1)),h(P),s[1]||(s[1]=i("div",{class:"uip-border-bottom"},null,-1)),h(X),s[2]||(s[2]=i("div",{class:"uip-border-bottom"},null,-1))]))}};export{te as default};
//# sourceMappingURL=index-B2FXRSrn.js.map
