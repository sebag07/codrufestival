{"version":3,"file":"index-DASFFZQX.js","sources":["../../src/pages/error-log/index.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, getCurrentInstance, watch } from \"vue\";\nconst { __ } = wp.i18n;\nimport { useRouter } from \"vue-router\";\n\n// Comps\nimport AppTable from \"@/components/table/index.vue\";\nimport Confirm from \"@/components/confirm/index.vue\";\n\n// Import funcs\nimport { sendServerRequest, formatDateString } from \"@/utility/functions.js\";\n\n// Refs\nconst errors = ref([]);\nconst currentError = ref(null);\nconst offcanvas = ref(null);\nconst loading = ref(true);\nconst confirmModal = ref(null);\nconst router = useRouter();\nconst { appContext } = getCurrentInstance();\nconst pagination = ref({ search: \"\", per_page: 15, page: 1, total: 0, pages: 0, status: \"any\", context: \"edit\" });\n\n// Setup table columns\nconst columns = ref([\n  { key: \"time\", label: __(\"Time\", \"uipress-lite\") },\n  { key: \"status\", label: __(\"Status\", \"uipress-lite\") },\n  { key: \"message\", label: __(\"Message\", \"uipress-lite\") },\n  { key: \"date\", label: __(\"Date\", \"uipress-lite\") },\n]);\n\n/**\n * Get's errors from server\n */\nconst getErrors = async (suppressLoading) => {\n  const { uipApp } = appContext.config.globalProperties;\n\n  loading.value = true;\n\n  const { per_page, search, page } = pagination.value;\n  const endpoint = `${uip_ajax.rest_url}uipress/v1/errorlog?per_page=${per_page}&search=${search}&page=${page}`;\n\n  const response = await fetch(endpoint, {\n    method: \"GET\",\n    headers: uip_ajax.rest_headers,\n  });\n\n  // Finish loading\n  loading.value = false;\n\n  // Throw error if failed\n  if (!response.ok) {\n    uipApp.notifications.notify(__(\"Unable to fetch error list right now\"), \"\", \"error\", true);\n    return;\n  }\n\n  const responseData = await response.json();\n\n  // Throw error if failed\n  if (response.error) {\n    uipApp.notifications.notify(__(\"Unable to fetch error list right now\"), \"\", \"error\", true);\n    return;\n  }\n\n  pagination.value.total = response.headers.get(\"X-WP-Total\");\n  pagination.value.pages = response.headers.get(\"X-WP-TotalPages\");\n\n  errors.value = responseData;\n};\n\nconst maybeStringify = (message) => {\n  try {\n    return JSON.stringify(JSON.parse(message), undefined, 2);\n  } catch (err) {\n    return message;\n  }\n};\n\n/**\n * Handles previous page\n */\nconst handlePreviousPage = () => {\n  if (pagination.value.page > 1) {\n    pagination.value.page--;\n    getErrors(true);\n  }\n};\n\n/**\n * Handles next page\n */\nconst handleNextPage = () => {\n  if (pagination.value.page < pagination.value.pages) {\n    pagination.value.page++;\n    getErrors(true);\n  }\n};\n\n/**\n * Opens the template\n */\nconst openError = (evt, index) => {\n  currentError.value = errors.value[index];\n\n  if (!currentError.value) return;\n\n  offcanvas.value.show();\n};\n\nconst returnStatusClass = (status) => {\n  if (status == \"MESSAGE\") return \"uip-border-green uip-text-green\";\n  if (status == \"FATAL\") return \"uip-border-red uip-text-red\";\n  if (status == \"WARNING\") return \"uip-border-orange uip-text-orange\";\n  return \"uip-border uip-text-muted\";\n};\n\n// Watch for empty search and reset query\nwatch(\n  () => pagination.value.search,\n  (newval, oldval) => {\n    if (!newval && oldval) getErrors();\n  }\n);\n\ngetErrors();\n</script>\n\n<template>\n  <AppTable\n    :pagination=\"pagination\"\n    :columns=\"columns\"\n    :data=\"errors\"\n    :fetching=\"loading\"\n    @previous=\"handlePreviousPage\"\n    @next=\"handleNextPage\"\n    @search=\"getErrors(true)\"\n    :rowClick=\"openError\"\n    :hideSelect=\"true\"\n  >\n    <!-- Right actions -->\n\n    <!-- Name-->\n    <template v-slot:row-time=\"{ row }\">\n      <div class=\"inline-flex uip-text-muted\">@{{ row.time }}</div>\n    </template>\n\n    <!-- Satus-->\n    <template v-slot:row-status=\"{ row }\">\n      <div class=\"uip-inline-flex uip-text-s uip-padding-left-xxs uip-padding-right-xxs uip-border uip-border-round uip-font-mono\" :class=\"returnStatusClass(row.type)\">\n        {{ row.type }}\n      </div>\n    </template>\n\n    <!-- Type-->\n    <template v-slot:row-message=\"{ row }\">\n      <div class=\"uip-max-w-200 uip-overflow-hidden uip-text-ellipsis uip-no-wrap\">\n        {{ row.message }}\n      </div>\n    </template>\n\n    <!-- Modified-->\n    <template v-slot:row-date=\"{ row }\">\n      <div class=\"inline-flex uip-text-muted\">\n        {{ row.date }}\n      </div>\n    </template>\n  </AppTable>\n\n  <component is=\"style\">\n    .gap-4 { gap: 1rem; } .grid-cols-6 { grid-template-columns: repeat(6, minmax(0px, 1fr)); } .grid { display: grid; }.col-span-5 { grid-column: span 5 / span 5; } .col-span-6 { grid-column: span 6 /\n    span 6; } .text-pretty { text-wrap: pretty; }</component\n  >\n\n  <uip-offcanvas ref=\"offcanvas\" style=\"width: 560px\">\n    <template v-slot:content>\n      <div class=\"uip-flex uip-flex-column uip-gap-s\">\n        <!-- Details-->\n        <div class=\"grid grid-cols-6 gap-4\">\n          <!--Staus-->\n          <div class=\"uip-text-muted\">{{ __(\"Status\", \"uipress-lite\") }}</div>\n          <div class=\"col-span-5 flex flex-row place-content-between\">\n            <div class=\"uip-inline-flex uip-text-s uip-padding-left-xxs uip-padding-right-xxs uip-border uip-border-round uip-font-mono\" :class=\"returnStatusClass(currentError.type)\">\n              {{ currentError.type }}\n            </div>\n          </div>\n          <div class=\"uip-border-top col-span-6\"></div>\n          <!--File-->\n          <template v-if=\"currentError.file\">\n            <div class=\"uip-text-muted\">\n              <div>{{ __(\"File\", \"uipress-lite\") }}</div>\n            </div>\n            <div class=\"col-span-5\">{{ currentError.file }}</div>\n            <div class=\"uip-border-top col-span-6\"></div>\n          </template>\n\n          <!--Line-->\n          <template v-if=\"currentError.line\">\n            <div class=\"uip-text-muted\">{{ __(\"Line\", \"uipress-lite\") }}</div>\n            <div class=\"col-span-5\">@{{ currentError.line }}</div>\n            <div class=\"uip-border-top col-span-6\"></div>\n          </template>\n\n          <!--Date-->\n          <div class=\"uip-text-muted\">{{ __(\"Date\", \"uipress-lite\") }}</div>\n          <div class=\"col-span-5\">{{ formatDateString(currentError.date) }}</div>\n          <div class=\"uip-border-top col-span-6\"></div>\n\n          <!--Time-->\n          <div class=\"uip-text-muted\">{{ __(\"Time\", \"uipress-lite\") }}</div>\n          <div class=\"col-span-5\">@{{ currentError.time }}</div>\n          <div class=\"uip-border-top col-span-6\"></div>\n\n          <!--Message-->\n          <div class=\"uip-text-muted\">\n            <div>{{ __(\"Message\", \"uipress-lite\") }}</div>\n          </div>\n          <div class=\"col-span-5\">\n            <pre v-html=\"maybeStringify(currentError.message)\" class=\"text-pretty\" style=\"margin: 0\"></pre>\n          </div>\n          <div class=\"uip-border-top col-span-6\"></div>\n\n          <!--Message-->\n          <template v-if=\"currentError.stackTrace.length\">\n            <div class=\"uip-text-muted\">\n              <div>{{ __(\"Stack trace\", \"uipress-lite\") }}</div>\n            </div>\n            <div class=\"col-span-5 uip-flex uip-flex-column uip-gap-s\">\n              <div v-for=\"(stack, index) in currentError.stackTrace\">{{ stack }}</div>\n            </div>\n            <div class=\"uip-border-top col-span-6\"></div>\n          </template>\n        </div>\n      </div>\n    </template>\n  </uip-offcanvas>\n</template>\n"],"names":["__","errors","ref","currentError","offcanvas","loading","useRouter","appContext","getCurrentInstance","pagination","columns","getErrors","suppressLoading","uipApp","per_page","search","page","endpoint","response","responseData","maybeStringify","message","handlePreviousPage","handleNextPage","openError","evt","index","returnStatusClass","status","watch","newval","oldval"],"mappings":"0+BAEA,KAAM,CAAE,GAAAA,CAAE,EAAK,GAAG,KAWZC,EAASC,EAAI,EAAE,EACfC,EAAeD,EAAI,IAAI,EACvBE,EAAYF,EAAI,IAAI,EACpBG,EAAUH,EAAI,EAAI,EACHA,EAAI,IAAI,EACdI,EAAS,EACxB,KAAM,CAAE,WAAAC,CAAY,EAAGC,EAAoB,EACrCC,EAAaP,EAAI,CAAE,OAAQ,GAAI,SAAU,GAAI,KAAM,EAAG,MAAO,EAAG,MAAO,EAAG,OAAQ,MAAO,QAAS,OAAQ,EAG1GQ,EAAUR,EAAI,CAClB,CAAE,IAAK,OAAQ,MAAOF,EAAG,OAAQ,cAAc,CAAG,EAClD,CAAE,IAAK,SAAU,MAAOA,EAAG,SAAU,cAAc,CAAG,EACtD,CAAE,IAAK,UAAW,MAAOA,EAAG,UAAW,cAAc,CAAG,EACxD,CAAE,IAAK,OAAQ,MAAOA,EAAG,OAAQ,cAAc,CAAG,CACpD,CAAC,EAKKW,EAAY,MAAOC,GAAoB,CAC3C,KAAM,CAAE,OAAAC,CAAM,EAAKN,EAAW,OAAO,iBAErCF,EAAQ,MAAQ,GAEhB,KAAM,CAAE,SAAAS,EAAU,OAAAC,EAAQ,KAAAC,CAAM,EAAGP,EAAW,MACxCQ,EAAW,GAAG,SAAS,QAAQ,gCAAgCH,CAAQ,WAAWC,CAAM,SAASC,CAAI,GAErGE,EAAW,MAAM,MAAMD,EAAU,CACrC,OAAQ,MACR,QAAS,SAAS,YACtB,CAAG,EAMD,GAHAZ,EAAQ,MAAQ,GAGZ,CAACa,EAAS,GAAI,CAChBL,EAAO,cAAc,OAAOb,EAAG,sCAAsC,EAAG,GAAI,QAAS,EAAI,EACzF,MACJ,CAEE,MAAMmB,EAAe,MAAMD,EAAS,KAAM,EAG1C,GAAIA,EAAS,MAAO,CAClBL,EAAO,cAAc,OAAOb,EAAG,sCAAsC,EAAG,GAAI,QAAS,EAAI,EACzF,MACJ,CAEES,EAAW,MAAM,MAAQS,EAAS,QAAQ,IAAI,YAAY,EAC1DT,EAAW,MAAM,MAAQS,EAAS,QAAQ,IAAI,iBAAiB,EAE/DjB,EAAO,MAAQkB,CACjB,EAEMC,EAAkBC,GAAY,CAClC,GAAI,CACF,OAAO,KAAK,UAAU,KAAK,MAAMA,CAAO,EAAG,OAAW,CAAC,CACxD,MAAa,CACZ,OAAOA,CACX,CACA,EAKMC,EAAqB,IAAM,CAC3Bb,EAAW,MAAM,KAAO,IAC1BA,EAAW,MAAM,OACjBE,EAAc,EAElB,EAKMY,EAAiB,IAAM,CACvBd,EAAW,MAAM,KAAOA,EAAW,MAAM,QAC3CA,EAAW,MAAM,OACjBE,EAAc,EAElB,EAKMa,EAAY,CAACC,EAAKC,IAAU,CAChCvB,EAAa,MAAQF,EAAO,MAAMyB,CAAK,EAElCvB,EAAa,OAElBC,EAAU,MAAM,KAAM,CACxB,EAEMuB,EAAqBC,GACrBA,GAAU,UAAkB,kCAC5BA,GAAU,QAAgB,8BAC1BA,GAAU,UAAkB,oCACzB,4BAIT,OAAAC,EACE,IAAMpB,EAAW,MAAM,OACvB,CAACqB,EAAQC,IAAW,CACd,CAACD,GAAUC,GAAQpB,EAAW,CACtC,CACA,EAEAA,EAAW"}