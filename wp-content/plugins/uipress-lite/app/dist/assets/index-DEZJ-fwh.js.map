{"version":3,"file":"index-DEZJ-fwh.js","sources":["../../src/pages/home/index.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, getCurrentInstance } from \"vue\";\nconst { __ } = wp.i18n;\nimport { useRouter } from \"vue-router\";\n\n// Comps\nimport AppTable from \"@/components/table/index.vue\";\nimport Confirm from \"@/components/confirm/index.vue\";\n\n// Import funcs\nimport { sendServerRequest } from \"@/utility/functions.js\";\n\n// Refs\nconst templates = ref([]);\nconst loading = ref(true);\nconst confirmModal = ref(null);\nconst router = useRouter();\nconst templateContextMenu = ref(null);\nconst activeTemplateID = ref(null);\nconst { appContext } = getCurrentInstance();\nconst pagination = ref({ search: \"\", per_page: 30, page: 1, total: 0, pages: 0, status: \"any\", context: \"edit\" });\n\n// Setup table columns\nconst columns = ref([\n  { key: \"name\", label: __(\"Name\", \"uipress-lite\") },\n  { key: \"status\", label: __(\"Status\", \"uipress-lite\") },\n  { key: \"type\", label: __(\"Type\", \"uipress-lite\") },\n  { key: \"modified\", label: __(\"Modified\", \"uipress-lite\") },\n  { key: \"actions\", width: \"30px\" },\n]);\n\n// Setup table columns\nconst templateLinks = computed(() => {\n  return [\n    { name: __(\"Edit\", \"uipress-lite\"), icon: \"edit\", type: \"link\", url: `/uibuilder/${activeTemplateID.value}` },\n    { name: __(\"Duplicate\", \"uipress-lite\"), icon: \"content_copy\", type: \"action\", action: () => duplicateTemplate(activeTemplateID.value) },\n    { type: \"divider\" },\n    { name: __(\"Delete\", \"uipress-lite\"), icon: \"delete\", type: \"action\", action: () => confirmDelete(activeTemplateID.value), danger: true },\n  ];\n});\n\n/**\n * Get's templates from server\n */\nconst getTemplates = async (suppressLoading) => {\n  if (!suppressLoading) loading.value = true;\n\n  let formData = new FormData();\n  formData.append(\"action\", \"uip_get_ui_templates\");\n  formData.append(\"security\", uip_ajax.security);\n  formData.append(\"page\", pagination.value.page);\n  formData.append(\"search\", pagination.value.search);\n  formData.append(\"filter\", \"all\");\n\n  const response = await sendServerRequest(uip_ajax.ajax_url, formData);\n\n  // Finish loading\n  loading.value = false;\n\n  // Error\n  if (!response) return;\n\n  templates.value = response.templates;\n};\n\n/**\n * Handles previous page\n */\nconst handlePreviousPage = () => {\n  if (pagination.value.page > 1) {\n    pagination.value.page--;\n    getTemplates(true);\n  }\n};\n\n/**\n * Handles next page\n */\nconst handleNextPage = () => {\n  if (pagination.value.page < pagination.value.pages) {\n    pagination.value.page++;\n    getTemplates(true);\n  }\n};\n\n/**\n * Opens the template\n */\nconst openTemplate = (evt, index) => {\n  const template = returnTemplates.value[index];\n\n  if (!template) return;\n\n  router.push(`/uibuilder/${template.id}`);\n};\n\n/**\n * Returns translatable status\n */\nconst returnFormattedStatus = (status) => {\n  if (status == \"publish\") return __(\"Published\", \"uipress-lite\");\n  return __(\"Draft\", \"uipress-lite\");\n};\n\nconst returnTemplates = computed(() => {\n  const searchTerm = pagination.value.search.toLowerCase();\n  return templates.value.filter((template) => template.name.toLowerCase().includes(searchTerm));\n});\n\n/**\n * Set's current template id and shows context menu\n */\nconst handleRightClick = (evt, index) => {\n  const template = returnTemplates.value[index];\n\n  if (!template) return;\n\n  activeTemplateID.value = template.id;\n\n  templateContextMenu.value.show(evt);\n};\n\n/**\n * Re-ads default toolbar styling\n *\n * @since 3.2.0\n */\nconst enqueueAdminBarStyles = () => {\n  let styleblock = document.querySelector('link[href*=\"load-styles.php?\"]');\n  if (!styleblock) return;\n\n  // Stylesheet already has admin styles enqueued\n  if (styleblock.href.includes(\"admin-bar,\")) return;\n\n  const newLink = styleblock.href.replace(\"admin-menu,\", \"admin-menu,admin-bar,\");\n  const link = document.createElement(\"link\");\n  link.href = newLink;\n  link.setAttribute(\"rel\", \"stylesheet\");\n\n  // Event listener function\n  const onLoad = () => {\n    styleblock.remove();\n    link.removeEventListener(\"load\", onLoad); // Remove the event listener\n  };\n\n  const head = document.head;\n  if (head.firstChild) {\n    head.insertBefore(link, head.firstChild);\n  } else {\n    head.appendChild(link);\n  }\n\n  // Add the event listener\n  link.addEventListener(\"load\", onLoad);\n};\n\n/**\n * Duplicates a template\n *\n * @param {Number} id - template id to duplicate\n * @returns {Promise}\n * @since 3.2.13\n */\nconst duplicateTemplate = async (id) => {\n  const { uipApp } = appContext.config.globalProperties;\n\n  let formData = new FormData();\n  formData.append(\"action\", \"uip_duplicate_ui_template\");\n  formData.append(\"security\", uip_ajax.security);\n  formData.append(\"id\", id);\n\n  const response = await sendServerRequest(uip_ajax.ajax_url, formData);\n\n  // Catch error\n  if (response.error) {\n    uipApp.notifications.notify(response.message, \"\", \"error\", true);\n    return;\n  }\n\n  // Template duplicated\n  uipApp.notifications.notify(__(\"Template duplicated\", \"uipress-lite\"), \"\", \"success\", true);\n  getTemplates(true);\n};\n\n/**\n * Confirms the deletion of template\n *\n * @param {Number} id - id of template to delete\n * @since 3.0.0\n */\nconst confirmDelete = async (id) => {\n  const confirm = await confirmModal.value.show({\n    title: __(\"Delete template\", \"uipress-lite\"),\n    message: __(\"Deleted templates can't be recovered\", \"uipress-lite\"),\n    okButton: __(\"Delete\", \"uipress-lite\"),\n  });\n  if (!confirm) return;\n  deleteTemplate(id);\n};\n\n/**\n * Deletes templates by ids\n *\n * @param {Array} ids - array of templates to delete\n * @returns {Promise}\n * @since 3.0.0\n */\nconst deleteTemplate = async (ids) => {\n  const { uipApp } = appContext.config.globalProperties;\n\n  let formData = new FormData();\n  formData.append(\"action\", \"uip_delete_ui_template\");\n  formData.append(\"security\", uip_ajax.security);\n  formData.append(\"templateids\", ids);\n\n  const response = await sendServerRequest(uip_ajax.ajax_url, formData);\n\n  // Handle error\n  if (response.error) {\n    uipApp.notifications.notify(response.message, \"\", \"error\", true);\n    return;\n  }\n\n  // Success message\n  uipApp.notifications.notify(response.message, \"\", \"success\", true);\n  getTemplates(true);\n};\n\n/**\n * Creates new draft ui template\n *\n * @since 3.0.0\n */\nconst createNewUI = async (templateType) => {\n  let formData = new FormData();\n  formData.append(\"action\", \"uip_create_new_ui_template\");\n  formData.append(\"security\", uip_ajax.security);\n  formData.append(\"templateType\", templateType);\n\n  const response = await sendServerRequest(uip_ajax.ajax_url, formData);\n\n  // Catch error\n  if (!response) return;\n\n  router.push(`/uibuilder/${response.id}/`);\n};\n\n/**\n * Runs link action and closes context\n */\nconst handleLinkAction = (link) => {\n  link.action();\n  templateContextMenu.value.close();\n};\n\nif (window.parent) {\n  window.parent.postMessage({ eventName: \"uip_exit_fullscreen\" }, \"*\");\n}\n\ngetTemplates();\n//enqueueAdminBarStyles();\n</script>\n\n<template>\n  <AppTable\n    :pagination=\"pagination\"\n    :columns=\"columns\"\n    :data=\"returnTemplates\"\n    :fetching=\"loading\"\n    @previous=\"handlePreviousPage\"\n    @next=\"handleNextPage\"\n    :rowClick=\"openTemplate\"\n    :rowRightClick=\"handleRightClick\"\n    :hideSelect=\"true\"\n  >\n    <!-- Right actions -->\n\n    <template v-slot:right-actions>\n      <!-- New template -->\n      <button class=\"uip-button-primary uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-text-s\" @click=\"createNewUI('ui-template')\">\n        {{ __(\"New template\", \"uipress-lite\") }}\n      </button>\n    </template>\n\n    <!-- Empty slot-->\n    <template v-slot:empty>\n      <div class=\"uip-flex uip-flex-column uip-gap-s uip-padding-l uip-flex-center\">\n        <AppIcon icon=\"folder_open\" style=\"font-size: 60px\" />\n        <div class=\"uip-text-bold uip-text-xl uip-text-emphasis\">{{ __(\"No templates yet\", \"uipress-lite\") }}</div>\n        <div class=\"uip-text-muted\">{{ __(\"When you create new templates they will show up here.\", \"uipress-lite\") }}</div>\n        <button class=\"uip-button-primary uip-flex uip-flex-row uip-gap-xxs uip-flex-center uip-text-s\" @click=\"createNewUI('ui-template')\">\n          {{ __(\"New template\", \"uipress-lite\") }}\n        </button>\n      </div>\n    </template>\n\n    <!-- Name-->\n    <template v-slot:row-name=\"{ row }\">\n      <div class=\"inline-flex uip-text-emphasis\">\n        {{ row.name }}\n      </div>\n    </template>\n\n    <!-- Satus-->\n    <template v-slot:row-status=\"{ row }\">\n      <div\n        class=\"uip-inline-flex uip-text-s uip-padding-left-xxs uip-padding-right-xxs uip-border uip-border-round\"\n        :class=\"row.status === 'publish' ? 'uip-border-green uip-text-green' : 'uip-border-orange uip-text-orange'\"\n      >\n        {{ returnFormattedStatus(row.status) }}\n      </div>\n    </template>\n\n    <!-- Type-->\n    <template v-slot:row-type=\"{ row }\">\n      <div class=\"uip-inline-flex uip-text-s uip-padding-left-xxs uip-padding-right-xxs uip-border uip-border-round uip-background-muted uip-text-normal\">\n        {{ row.type }}\n      </div>\n    </template>\n\n    <!-- Modified-->\n    <template v-slot:row-modified=\"{ row }\">\n      <div class=\"inline-flex uip-text-muted\">\n        {{ row.modified }}\n      </div>\n    </template>\n\n    <!-- Actions -->\n    <template v-slot:row-actions=\"{ row }\">\n      <div class=\"inline-flex uip-text-muted\">\n        <AppIcon\n          icon=\"more_horiz\"\n          @click.stop.prevent=\"\n            ($event) => {\n              activeTemplateID = row.id;\n              templateContextMenu.show($event);\n            }\n          \"\n        />\n      </div>\n    </template>\n  </AppTable>\n\n  <contextmenu ref=\"templateContextMenu\">\n    <div class=\"uip-padding-xs uip-flex uip-flex-column uip-text-weight-normal\">\n      <template v-for=\"link in templateLinks\">\n        <div v-if=\"link.type == 'divider'\" class=\"uip-border-top uip-margin-top-xs uip-margin-bottom-xs\"></div>\n\n        <RouterLink\n          v-else-if=\"link.type == 'link'\"\n          :to=\"link.url\"\n          class=\"uip-link-muted uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline\"\n        >\n          <span class=\"\">{{ link.name }}</span>\n          <AppIcon :icon=\"link.icon\" class=\"uip-icon\" />\n        </RouterLink>\n\n        <a\n          v-else\n          @click=\"handleLinkAction(link)\"\n          class=\"uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline\"\n          :class=\"link.danger ? 'uip-link-danger' : 'uip-link-muted'\"\n        >\n          <span class=\"\">{{ link.name }}</span>\n          <AppIcon :icon=\"link.icon\" class=\"uip-icon\" />\n        </a>\n      </template>\n    </div>\n  </contextmenu>\n\n  <Confirm ref=\"confirmModal\" />\n</template>\n"],"names":["__","templates","ref","loading","confirmModal","router","useRouter","templateContextMenu","activeTemplateID","appContext","getCurrentInstance","pagination","columns","templateLinks","computed","duplicateTemplate","confirmDelete","getTemplates","suppressLoading","formData","response","sendServerRequest","handlePreviousPage","handleNextPage","openTemplate","evt","index","template","returnTemplates","returnFormattedStatus","status","searchTerm","handleRightClick","id","uipApp","deleteTemplate","ids","createNewUI","templateType","handleLinkAction","link"],"mappings":"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"}