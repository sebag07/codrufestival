import{X as M,b as m,Y as X,p as ce,c as b,H as pe,I as de,f as me,o as r,g as p,t as G,q as fe,N as ye,j as S,k as F,l as f,m as _,z as P,F as y,E as J,y as w,D as $,u as ge,Z as ve,$ as T,a0 as j,n as H,a1 as Q,a2 as K,O as he,a3 as be,P as Se,Q as we,R as Te,U as ke,V as Ae,W as De}from"./index-COn-5JHg.js";const Ie=i=>{const t=document.querySelector("#uip-app-data");if(!t)return;const o=t.getAttribute("rest-base"),v=t.getAttribute("rest-nonce"),d=t.getAttribute("cache-key"),h=t.getAttribute("template-type"),E=t.getAttribute("template-id"),k=t.getAttribute("plugin-base"),A=t.getAttribute("site-id"),x=t.getAttribute("admin-url"),R=t.getAttribute("site-url"),U=t.getAttribute("user-id"),C=t.getAttribute("user-name"),O=t.getAttribute("is-admin");let g=t.getAttribute("user-roles");g=JSON.parse(g),i.updateState("restBase",o),i.updateState("restNonce",v),i.updateState("userRoles",g),i.updateState("cacheKey",d),i.updateState("pluginBase",k),i.updateState("adminUrl",x),i.updateState("siteURL",R),i.updateState("userID",U),i.updateState("username",C),i.updateState("siteID",A),i.updateState("isAdmin",O=="1"),i.updateState("templateType",M.value.templateType||h),i.updateState("templateID",M.value.templateId||E),i.updateState("teleportPoint","body")};document.createDocumentFragment();const Ne=["adopted-style-sheets"],_e={key:1,class:"",style:{"text-align":"center",padding:"60px",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},Pe={__name:"index",setup(i){const t=m({display:"prod",notifications:[],settings:null,content:null,globalSettings:null,updated:null,id:null}),o=X(),v=m(new CSSStyleSheet),d=m(!1);m(!1);const h=m(window.innerWidth),E=m(null),k=m(null);ce("uiTemplate",t.value);const A=b(()=>ve(T.data.themeStyles)?T.data.themeStyles:{});b(()=>{var a,e;if(!(typeof((e=(a=t.value)==null?void 0:a.globalSettings)==null?void 0:e.options)>"u"))return j(t.value,"globalSettings","options","advanced","js")});const x=b(()=>{var a,e;if(!(typeof((e=(a=t.value)==null?void 0:a.globalSettings)==null?void 0:e.options)>"u"))return j(t.value,"globalSettings","options","advanced","css")}),R=b(()=>h.value>=990?"uip-desktop-view":h.value>=699?"uip-tablet-view":"uip-phone-view"),U=async()=>{d.value=!0,await C(),H(()=>{d.value=!1})},C=async()=>{const a=o.state.templateType,e=o.state.templateID;if(a==="ui-template"){const s=Z();if(s==="no_templates")return I();if(s)return D(s);await g()}a==="ui-front-template"&&await g(),a==="ui-admin-page"&&e&&await O()},O=async()=>{const e={endpoint:`wp/v2/uip-ui-template/${o.state.templateID}`,params:{per_page:1,status:"publish"}},s=await Q(e);if(!s){I();return}const n=s.data;n&&D(n)},g=async()=>{const e=await Q({endpoint:"wp/v2/uip-ui-template",params:{per_page:100,status:"publish"}});if(!e){I();return}const s=e.data;s.length?Y(s):q()},Y=a=>{var n,c;const e=o.state.templateType,s=o.state.userRoles;for(let l of a){if(l.uipress.type!==e)continue;if(e=="ui-template"){const u=JSON.stringify(l.uipress.template);if(!u.includes("uip-content")||!u.includes("uip-admin-menu-new"))continue}const ae=l.uipress.forRoles||[],se=l.uipress.forUsers||[],ne=l.uipress.excludesRoles||[],oe=l.uipress.excludesUsers||[],ie=(c=(n=l.uipress)==null?void 0:n.settings)==null?void 0:c.applyToEveryone,re=se.find(u=>u==o.state.userID);let z=!1;for(let u of s)if(ae.find(B=>B==u)){z=!0;break}const le=oe.find(u=>u==o.state.userID);let W=!1;for(let u of s)if(ne.find(B=>B==u)){W=!0;break}if(ie==="uiptrue"){D(l),L(l);return}else if((re||z)&&!le&&!W){D(l),L(l);return}}q(),I()},Z=()=>{try{const a=localStorage.getItem(N.value);if(!a)return null;const{template:e,cacheKey:s}=JSON.parse(a);return o.state.cacheKey==s?e:(localStorage.removeItem(N.value),null)}catch(a){return console.error("Failed to retrieve cached template:",a),null}},L=a=>{if(o.state.templateType==="ui-front-template")return;const s={template:a,cacheKey:o.state.cacheKey};try{return localStorage.setItem(N.value,JSON.stringify(s)),!0}catch(n){return console.error("Failed to cache template:",n),!1}},q=()=>{if(o.state.templateType==="ui-front-template")return;const e={template:"no_templates",no_templates:!0,cacheKey:o.state.cacheKey};try{return localStorage.setItem(N.value,JSON.stringify(e)),!0}catch(s){return console.error("Failed to cache template:",s),!1}},D=a=>{const e=o.state.templateType;if(e==="ui-template"&&(document.body.style.opacity=1,document.documentElement.style.overflow="hidden"),o.updateState("teleportPoint",k.value),e!="ui-admin-page"){const s=document.querySelector("#uipress-admin-bar-css");s&&s.remove()}t.value.settings=K(JSON.stringify(a.uipress.settings)),t.value.content=K(JSON.stringify(a.uipress.template)),t.value.globalSettings=K(JSON.stringify(a.uipress.settings)),t.value.id=a.id,H(()=>{d.value=!1})},I=()=>{document.body.style.opacity=1,document.documentElement.style.overflow="auto",document.documentElement.removeAttribute("uip-core-app"),document.documentElement.removeAttribute("uip-admin-theme");const a=document.querySelector("#uip-ui-interface");a&&a.remove();const e=document.querySelector("#uip-frontend-toolbar");e&&e.remove();const s=document.querySelector("#uip-front-end-hider");s&&s.remove()},V=()=>{h.value=window.innerWidth},ee=()=>{const a=T.data.userPrefs.darkTheme;T.data.userPrefs.darkTheme=!a;const e=a?"light":"dark";document.documentElement.setAttribute("data-theme",e);const s=document.querySelectorAll("iframe");if(s){for(const n of s){const c=n.contentWindow.document.documentElement;c&&c.setAttribute("data-theme",e)}saveUserPreference("darkTheme",!a,!1)}},te=()=>{const a=document.querySelectorAll(".notice:not(#message):not(.inline):not(.update-message),.wp-analytify-notification");if(!a)return;t.value.notifications=[];let e=!1;JSON.stringify(t.value.content).includes("site-notifications")&&(e=!0);for(const n of a)t.value.notifications.push(n.outerHTML.replace("uip-framed-page=1","")),e&&n.setAttribute("style","display:none !important; visibility: hidden !important; opacity: 0 !important;");T.data.dynamicOptions.notificationCount.value=t.value.notifications.length},N=b(()=>`uipress_templates_${o.state.userID}_${o.state.siteID}`);return pe(()=>{window.addEventListener("resize",V),te(),U()}),de(()=>{window.removeEventListener("resize",V),document.removeEventListener("uipress/app/darkmode/toggle",ee)}),(a,e)=>{const s=me("uip-content-area");return r(),p("div",{is:"div",tag:"div","adopted-style-sheets":[v.value],ref_key:"shadowMount",ref:E,id:"uipress-shadow-root",class:"uip-w-100p uipress-normalize"},[G("div",{class:$(["uip-h-100p uip-background-default uip-user-frame uip-body-font uip-teleport uip-flex overflow-hidden",ge(o).state.templateType==="ui-template"?"uip-w-vw":"uip-w-100p"])},[fe(ye),d.value?P("",!0):(r(),S(_("style"),{key:0},{default:F(()=>e[0]||(e[0]=[f("#wpadminbar{opacity:1 !important}")])),_:1})),(r(),S(_("style"),{scoped:"",id:"uip-theme-styles"},{default:F(()=>[e[1]||(e[1]=f(" html[data-theme='light'], html { ")),(r(!0),p(y,null,J(A.value,(n,c)=>(r(),p(y,null,[n.value&&n.value!="uipblank"?(r(),p(y,{key:0},[f(w(c)+":"+w(n.value)+";",1)],64)):P("",!0)],64))),256)),e[2]||(e[2]=f(' } html[data-theme="dark"], .uip-dark-mode, #uip-admin-page .uip-dark-mode, #uip-ui-interface .uip-dark-mode { ')),(r(!0),p(y,null,J(A.value,(n,c)=>(r(),p(y,null,[n.darkValue&&n.darkValue!="uipblank"?(r(),p(y,{key:0},[f(w(c)+":"+w(n.darkValue)+" !important;",1)],64)):P("",!0)],64))),256)),f(" } "+w(x.value),1)]),_:1})),(r(),S(_("style"),null,{default:F(()=>e[3]||(e[3]=[f(" .v-enter-active, .v-leave-active {transition: opacity 0.6s ease;} .v-enter-from, .v-leave-to {opacity: 0;} ")])),_:1})),d.value?(r(),p("div",_e,"Loading...")):d.value?P("",!0):(r(),S(s,{key:2,content:t.value.content,class:$(R.value)},null,8,["content","class"])),(r(!0),p(y,null,J(a.uipGlobalPlugins,n=>(r(),S(_(n)))),256)),G("div",{ref_key:"teleportPoint",ref:k},null,512)],2)],8,Ne)}}};wp.i18n;const xe=i=>{const t=he(Pe),o=be();t.use(o);const v=X();Ie(v),Se(t),we(t),Te(t,"prod"),ke(t),Ae(t),De(t),t.mount(i)};export{xe as s};
//# sourceMappingURL=setupApp-erJstP6L.js.map
